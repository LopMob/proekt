stages:
  - check
  - test

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (lint)
lint:
  stage: check
  script:
    - echo "üîç –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–∞..."
    - if [ -f "package.json" ]; then npm install && npm run lint; fi       # JavaScript (ESLint)
    - if [ -f "requirements.txt" ]; then pip install pylint && pylint .; fi # Python (Pylint)
    - if [ -f "Gemfile" ]; then bundle install && rubocop; fi              # Ruby (RuboCop)
    - if [ -f "*.sh" ]; then shellcheck *.sh; fi                           # Bash (ShellCheck)
  rules:
    - if: $CI_COMMIT_BRANCH == "main"  # —Ç–æ–ª—å–∫–æ –¥–ª—è main-–≤–µ—Ç–∫–∏

# 2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–ø—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞)
test:
  stage: test
  script:
    - echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
    - if [ -f "package.json" ]; then npm test; fi         # JavaScript
    - if [ -f "pytest.ini" ]; then pytest; fi             # Python
    - if [ -f "Rakefile" ]; then bundle exec rspec; fi    # Ruby
    - if [ -f "go.mod" ]; then go test ./...; fi          # Go
  rules:
    - if: $CI_PIPELINE_SOURCE == "push"  # –¥–ª—è –≤—Å–µ—Ö –ø—É—à–∞—Ö
